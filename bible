#!/usr/bin/env python3

import sys
from bs4 import BeautifulSoup
import requests

def versions():
    return {'NIV', 'NLT'}

def usage():
    print('./bible [passage] [version]')
    sys.exit()

def parse_args():
    query = sys.argv
    del query[0]
    if len(query) == 0:
        usage()
    version = 'NIV'
    if query[-1].upper() in versions():
        version = query[-1].upper()
        del query[-1]
    return ' '.join(query), version

def get_soup(query, version):
    r = requests.get('https://www.biblegateway.com/passage/?search=' + query + '&version=' + version)
    return BeautifulSoup(r.text,  "html.parser")

def get_passage(soup):
    verses = soup.find(class_="result-text-style-normal").select('p, div.poetry')
    return "\n".join(map(lambda v : v.text, verses))

query, version = parse_args()
soup = get_soup(query, version)
print(get_passage(soup))
